ЛЕКЦИЯ 1

Введение в Django
------------------------------------------------

Виртуальное окружение

  Создаём виртуальное окружение в Linux или MacOS
      python -m venv .venv

Далее активируем виртуальное окружение, чтобы все дальнейшие действия выполнялись внутри него. 
      venv\Scripts\activate.ps1 # Windows PowerShell

----------------------------------------------------
Установка Django и обязательный компонентов

  Для установки Django рекомендуется использовать менеджер пакетов pip.
  Для этого необходимо открыть терминал и выполнить команду:

pip install django


----------------------------------------------------
Создание проекта

  Для создания нового проекта в Django необходимо выполнить команду django-admin startproject <project_name>.
  Эта команда создаст структуру проекта, которая будет содержать все необходимые файлы и папки для работы с 
  фреймворком.

Пример:
django-admin startproject myproject

----------------------------------------------------
Структура проекта Django

● manage.py - файл, который используется для управления проектом.
    С его помощью можно запустить сервер, создать миграции, создать суперпользователя и т.д.
      ● myproject/ - директория, которая содержит основные файлы проекта.
      ● __init__.py - файл, который сообщает Python, что директория myproject является пакетом.
      ● settings.py - файл, который содержит настройки проекта, такие как базы данных, шаблоны, статические файлы и т.д.
      ● urls.py - файл, который содержит маршруты приложения.
      ● asgi.py - файл, который используется для запуска проекта в ASGI-совместимых серверах.
      ● wsgi.py - файл, который используется для запуска проекта в WSGI-совместимых серверах.

----------------------------------------------------
Запуск сервера и проверка работоспособности

Для запуска сервера необходимо выполнить команду python manage.py runserver.
Эта команда запустит сервер на локальном хосте и порту 8000.
Внимание! Команда должна выполняться из каталога, который содержит файл manage.py.
Не забудьте перейти в него командой cd <имя проекта>

Пример:
python manage.py runserver

----------------------------------------------------
Пара дополнительных параметров runserver

  При запуске сервера можно явно заменить порт 8000 на другой.
  Например так мы воспользуемся портом 8080:
      python manage.py runserver 8080

Кроме того можно изменить IP-адрес сервера. Для этого он передаётся вместе с портом:
    python manage.py runserver 0.0.0.0:8080

Указав в качестве IP нули мы стали прослушивать все адреса. Если ваш компьютер находится в локальной сети,
доступ к проекту можно получить с других устройств этой же сети. Достаточно указать в адресной строке браузера 
IP-адрес компьютера, на котором запущен сервер. При этом Django может сообщить об ошибке вида:
    django.core.exceptions.DisallowedHost: Invalid HTTP_HOST header: '192.168.1.42:8000'.
    You may need to add '192.168.1.42' to ALLOWED_HOSTS.
    Bad Request: /favicon.ico

В константу ALLOWED_HOSTS файла settings.py необходимо добавить допустимые адреса в виде списка строк.
Например так:
    ALLOWED_HOSTS = [
        '127.0.0.1', 
        '192.168.1.47',
    ]

Важно! Вы всё ещё используете сервер для разработки. Следовательно демонстрируете в локальной сети проект коллегам,
а не даёте доступ конечному пользователю.


----------------------------------------------------
Создание первого приложения

  Создание приложения в Django представляет собой создание отдельного модуля,
  который будет содержать логику и шаблоны для определенной функциональности.
  Для создания приложения нужно выполнить команду
    
    python manage.py startapp <app_name>
  
  где <app_name> - название приложения.

Пример:
    

Структура проекта после создания приложения имеет следующий вид:

● myapp/ - директория приложения
    ○ migrations/ - директория для хранения миграций базы данных
    ■ __init__.py - файл, указывающий на то, что директория является пакетом Python
    ○ __init__.py - файл, указывающий на то, что директория является пакетом Python
    ○ admin.py - файл для настройки административного интерфейса приложения
    ○ apps.py - файл для настройки приложения
    ○ models.py - файл, содержащий модели данных приложения
    ○ tests.py - файл для написания тестов приложения
    ○ views.py - файл, содержащий представления (views) приложения
● myproject/ - директория проекта
    ○ __init__.py - файл, указывающий на то, что директория является пакетом Python
    ○ settings.py - файл, содержащий настройки проекта
    ○ urls.py - файл, содержащий маршруты (routes) для обработки URL-адресов
    ○ asgi.py - файл для запуска ASGI-сервера (Asynchronous Server Gateway Interface)
    ○ wsgi.py - файл для запуска WSGI-сервера (Web Server Gateway Interface)
    ● db.sqlite - файл базы данных SQLite
    ● manage.py - файл для управления проектом Django (запуск сервера, создание миграций и т.д.)

----------------------------------------------------
Добавление приложения в проект

  Чтобы добавить созданное приложение в проект, необходимо указать его в настройках проекта (файл settings.py).
  Для этого нужно добавить название приложения в список INSTALLED_APPS. 

Внимание! Хорошей привычкой будет делать два действия сразу друг за другом.
А именно создавать приложение через startapp и сразу добавляет его в список INSTALLED_APPS.

Учитывая добавленные по умолчанию приложения, константа INSTALLED_APPS будет выглядет так:
    INSTALLED_APPS = [
        'django.contrib.admin',
        'django.contrib.auth',
        'django.contrib.contenttypes',
        'django.contrib.sessions',
        'django.contrib.messages',
        'django.contrib.staticfiles',
        'myapp',
    ]

За что отвечают перечисленные в списке строки:
    ● django.contrib.admin - Сайт администратора.
    ● django.contrib.auth - Система аутентификации.
    ● django.contrib.contenttypes - Структура для типов контента.
    ● django.contrib.sessions - Структура сеанса.
    ● django.contrib.messages - Фреймворк обмена сообщениями.
    ● django.contrib.staticfiles - Фреймворк для управления статическими файлами.
    ● myapp - созданное вами приложение

----------------------------------------------------
Создание представления в приложении

  Следующий пункт работы - создать представление. Так же их называют view или просто “вьюшками”. 
  Для создания представления нужно определить функцию в файле views.py, которая будет обрабатывать
  запрос на эту страницу.

Пример кода:

    from django.http import HttpResponse

    def index(request):
        return HttpResponse("Hello, world!")

    def about(request):
        return HttpResponse("About us")


----------------------------------------------------
Настройка путей

  Открываем файл urls.py в корневой директории проекта
  Файл уже содержит комментарий с описанием трёх способов добавления маршрутов:
    ● функции представления
    ● классы представления
    ● подключение других файлов с настройками URL 

Сейчас нам нужен последний пункт. Пропишем добавление файла конфигурации маршрутов из приложения myapp в проект.

    from django.contrib import admin
    from django.urls import path, include

    urlpatterns = [
        path('admin/', admin.site.urls),
        path('', include('myapp.urls')),
    ]

----------------------------------------------------
Создаем файл urls.py в директории приложения

  Убедитесь, что вы создаёте файл внутри каталога myapp.
  Когда в вашем проекте будет несколько приложений, каждое будет иметь собственный urls.py с локальными маршрутами.
  А urls.py проекта будет включать (include()) их в глобальный список адресов.

Внутри myapp/urls.py пропишем следующий код:

    from django.urls import path
    from . import views
    urlpatterns = [
        path('', views.index, name='index'),
        path('about/', views.about, name='about'),
    ]

Немного подробнее о path() и include()

Прежде чем двигаться дальше, внесём небольшое изменение в написанный код.
Разберёмся в том как работают функции path и include из пакета django.urls.
Исправим файл myproject/urls.py.
Заменим первый параметр функции path с пустой строки на какой-нибудь текст,
например на prefix:

    from django.contrib import admin
    from django.urls import path, include

    urlpatterns = [
        path('admin/', admin.site.urls),
        path('prefix/', include('myapp.urls'))
    ]

----------------------------------------------------
Конфигурация логирования в Django

  Для настройки логирования в Django необходимо изменить файл settings.py.
  В этом файле определяются параметры логирования, такие как уровень логирования,
  формат вывода, место хранения логов и т.д.
  Конфигурация логирования в файле settings.py в Django происходит через словарь LOGGING.

  Вот пример настройки логирования:
    
    LOGGING = {
        'version': 1,
        'disable_existing_loggers': False,
        'handlers': {
            'console': {
                'class': 'logging.StreamHandler',
            },
            'file': {
                'class': 'logging.FileHandler',
                'filename': '/path/to/django.log',
            },
        },
        'loggers': {
            'django': {
                'handlers': ['console', 'file'],
                'level': 'INFO',
            },
        'myapp': {
            'handlers': ['console'],
            'level': 'DEBUG',
            'propagate': True,
            },
        },
    }

Давайте рассмотрим каждый параметр:
● version: версия формата конфигурации логирования.
    В настоящее время используется версия 1.
● disable_existing_loggers: если значение равно True, то все существующие логгеры будут отключены.
    Если значение равно False, то существующие логгеры будут продолжать работать.
● handlers: определяет, какие обработчики будут использоваться для записи логов.
    Обработчики могут быть консольными или файловыми.
● loggers: определяет, какие логгеры будут использоваться для записи логов.
    Логгеры могут быть определены для фреймворка Django или для конкретного приложения.

